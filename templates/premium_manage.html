{% extends "base.html" %}
{% block title %}Qu·∫£n l√Ω Premium - 2048{% endblock %}
{% block description %}N√¢ng c·∫•p t√†i kho·∫£n Premium ƒë·ªÉ m·ªü kh√≥a c√°c t√≠nh nƒÉng ƒë·∫∑c bi·ªát: ho√†n t√°c, g·ª£i √Ω n∆∞·ªõc ƒëi, x√°o tr·ªôn b√†n c·ªù, v√† ƒë·ªïi ch·ªó 2 √¥. N√¢ng c·∫•p ngay ƒë·ªÉ tr·∫£i nghi·ªám game t·ªët h∆°n!{% endblock %}
{% block content %}

<style>
.premium-manage-page {
  max-width: 1200px;
  margin: 0 auto;
  padding: 24px 16px;
}

/* Header Section */
.premium-header {
  text-align: center;
  margin-bottom: 40px;
  animation: fadeInDown 0.6s ease;
}

@keyframes fadeInDown {
  from {
    opacity: 0;
    transform: translateY(-20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.premium-title {
  font-size: 42px;
  font-weight: 900;
  margin: 0 0 12px 0;
  background: linear-gradient(135deg, #f59e0b 0%, #d97706 50%, #f59e0b 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
}

.premium-icon {
  font-size: 48px;
  animation: sparkle 2s ease-in-out infinite;
}

@keyframes sparkle {
  0%, 100% { transform: scale(1) rotate(0deg); filter: brightness(1); }
  50% { transform: scale(1.2) rotate(15deg); filter: brightness(1.3); }
}

.premium-subtitle {
  font-size: 18px;
  color: var(--muted);
  margin: 0;
}

/* Status Card */
.premium-status-wrapper {
  margin-bottom: 48px;
  animation: fadeInUp 0.6s ease 0.2s both;
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.premium-status-card {
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 250, 252, 0.95) 100%);
  backdrop-filter: blur(20px);
  border-radius: 24px;
  padding: 32px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
  border: 2px solid rgba(203, 213, 225, 0.5);
  transition: all 0.3s ease;
}

.premium-status-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.12);
}

.premium-status-card.premium-active {
  border-color: rgba(245, 158, 11, 0.5);
  background: linear-gradient(135deg, rgba(254, 243, 199, 0.3) 0%, rgba(253, 230, 138, 0.2) 100%);
}

.status-header {
  display: flex;
  justify-content: center;
  margin-bottom: 24px;
}

.status-icon-wrapper {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
}

.status-icon {
  font-size: 64px;
  animation: float 3s ease-in-out infinite;
}

.status-icon.inactive {
  opacity: 0.5;
  filter: grayscale(1);
}

@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}

.status-badge {
  background: linear-gradient(135deg, #10b981 0%, #059669 100%);
  color: white;
  padding: 6px 20px;
  border-radius: 20px;
  font-weight: 700;
  font-size: 14px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.status-content {
  text-align: center;
  margin-bottom: 24px;
}

.status-title {
  font-size: 28px;
  font-weight: 800;
  margin: 0 0 16px 0;
  color: var(--text);
}

.status-description {
  font-size: 16px;
  color: var(--muted);
  margin: 0;
}

.status-info {
  background: rgba(255, 255, 255, 0.6);
  border-radius: 16px;
  padding: 20px;
  margin-top: 16px;
}

.info-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
  font-size: 16px;
}

.info-label {
  font-weight: 600;
  color: var(--muted);
}

.info-value {
  font-weight: 700;
  color: var(--text);
  background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.progress-bar-wrapper {
  margin-top: 16px;
}

.progress-bar {
  width: 100%;
  height: 16px;
  background: linear-gradient(135deg, rgba(203, 213, 225, 0.3) 0%, rgba(226, 232, 240, 0.3) 100%);
  border-radius: 20px;
  overflow: hidden;
  position: relative;
  box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
  border: 1px solid rgba(203, 213, 225, 0.4);
}

.progress-bar::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 50%;
  background: linear-gradient(180deg, rgba(255, 255, 255, 0.3) 0%, transparent 100%);
  border-radius: 20px 20px 0 0;
  pointer-events: none;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, 
    #f59e0b 0%, 
    #fbbf24 25%, 
    #fcd34d 50%, 
    #fbbf24 75%, 
    #f59e0b 100%
  );
  border-radius: 20px;
  transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
  background-size: 200% 100%;
  animation: shimmer 3s linear infinite, pulse-glow 2s ease-in-out infinite;
  position: relative;
  box-shadow: 
    0 0 10px rgba(245, 158, 11, 0.5),
    0 0 20px rgba(251, 191, 36, 0.3),
    inset 0 1px 0 rgba(255, 255, 255, 0.4);
}

.progress-fill::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 50%;
  background: linear-gradient(180deg, rgba(255, 255, 255, 0.4) 0%, transparent 100%);
  border-radius: 20px 20px 0 0;
}

.progress-fill::after {
  content: '';
  position: absolute;
  top: 0;
  right: 0;
  width: 40px;
  height: 100%;
  background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.6) 50%, transparent 100%);
  animation: slide 2s ease-in-out infinite;
  border-radius: 20px;
}

@keyframes shimmer {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

@keyframes pulse-glow {
  0%, 100% { 
    box-shadow: 
      0 0 10px rgba(245, 158, 11, 0.5),
      0 0 20px rgba(251, 191, 36, 0.3),
      inset 0 1px 0 rgba(255, 255, 255, 0.4);
  }
  50% { 
    box-shadow: 
      0 0 15px rgba(245, 158, 11, 0.7),
      0 0 30px rgba(251, 191, 36, 0.5),
      inset 0 1px 0 rgba(255, 255, 255, 0.4);
  }
}

@keyframes slide {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(300%); }
}

.progress-text {
  display: block;
  text-align: center;
  margin-top: 12px;
  font-size: 15px;
  font-weight: 700;
  background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  animation: text-pulse 2s ease-in-out infinite;
}

@keyframes text-pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.8; }
}

/* Inactive Premium Styles */
.inactive-header {
  position: relative;
}

.lock-glow {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 120px;
  height: 120px;
  background: radial-gradient(circle, rgba(245, 158, 11, 0.3) 0%, transparent 70%);
  border-radius: 50%;
  animation: pulse-glow-lock 2s ease-in-out infinite;
  pointer-events: none;
}

@keyframes pulse-glow-lock {
  0%, 100% {
    transform: translate(-50%, -50%) scale(1);
    opacity: 0.5;
  }
  50% {
    transform: translate(-50%, -50%) scale(1.2);
    opacity: 0.8;
  }
}

.status-icon.inactive {
  opacity: 1;
  filter: none;
  animation: shake-lock 3s ease-in-out infinite;
}

@keyframes shake-lock {
  0%, 100% { transform: rotate(0deg); }
  10%, 30%, 50%, 70%, 90% { transform: rotate(-5deg); }
  20%, 40%, 60%, 80% { transform: rotate(5deg); }
}

.inactive-title {
  background: linear-gradient(135deg, #64748b 0%, #475569 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.inactive-description {
  font-size: 18px;
  line-height: 1.6;
}

.highlight-text {
  background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  font-weight: 800;
  font-size: 20px;
  animation: text-glow 2s ease-in-out infinite;
}

@keyframes text-glow {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

/* Feature List */
.feature-list {
  display: flex;
  flex-direction: column;
  gap: 16px;
  margin-top: 32px;
}

.inactive-features {
  background: linear-gradient(135deg, rgba(254, 243, 199, 0.3) 0%, rgba(253, 230, 138, 0.2) 100%);
  border-radius: 16px;
  padding: 24px;
  border: 2px dashed rgba(245, 158, 11, 0.3);
  position: relative;
  overflow: hidden;
}

.inactive-features::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: linear-gradient(45deg, transparent 30%, rgba(245, 158, 11, 0.1) 50%, transparent 70%);
  animation: shine 3s linear infinite;
  pointer-events: none;
}

@keyframes shine {
  0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
  100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
}

.feature-item {
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 20px;
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(248, 250, 252, 0.9) 100%);
  border-radius: 16px;
  font-weight: 600;
  font-size: 15px;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  border: 2px solid rgba(203, 213, 225, 0.5);
  position: relative;
  overflow: hidden;
  opacity: 0;
}

.feature-animated {
  animation: slideInUp 0.6s ease forwards;
}

@keyframes slideInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.feature-item::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(245, 158, 11, 0.2), transparent);
  transition: left 0.5s ease;
}

.feature-item:hover::before {
  left: 100%;
}

.feature-item:hover {
  background: linear-gradient(135deg, rgba(254, 243, 199, 0.5) 0%, rgba(253, 230, 138, 0.4) 100%);
  transform: translateX(8px) scale(1.02);
  border-color: rgba(245, 158, 11, 0.5);
  box-shadow: 0 8px 24px rgba(245, 158, 11, 0.2);
}

.feature-icon {
  font-size: 32px;
  flex-shrink: 0;
  animation: bounce-icon 2s ease-in-out infinite;
}

@keyframes bounce-icon {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-5px); }
}

.feature-text {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.feature-name {
  font-size: 16px;
  font-weight: 700;
  color: var(--text);
}

.feature-desc {
  font-size: 13px;
  font-weight: 500;
  color: var(--muted);
  line-height: 1.4;
}

.feature-badge {
  background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
  color: white;
  padding: 6px 14px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
  animation: pulse-badge 2s ease-in-out infinite;
  flex-shrink: 0;
}

@keyframes pulse-badge {
  0%, 100% {
    transform: scale(1);
    box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
  }
  50% {
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(245, 158, 11, 0.5);
  }
}

/* Upgrade CTA */
.upgrade-cta {
  margin-top: 32px;
  text-align: center;
  animation: fadeInUp 0.6s ease 0.5s both;
}

.btn-upgrade-now {
  display: inline-flex;
  align-items: center;
  gap: 12px;
  padding: 18px 36px;
  background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
  color: white;
  text-decoration: none;
  border-radius: 50px;
  font-weight: 800;
  font-size: 18px;
  transition: all 0.3s ease;
  box-shadow: 0 8px 24px rgba(245, 158, 11, 0.4);
  position: relative;
  overflow: hidden;
}

.btn-upgrade-now::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 0;
  height: 0;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.3);
  transform: translate(-50%, -50%);
  transition: width 0.6s ease, height 0.6s ease;
}

.btn-upgrade-now:hover::before {
  width: 300px;
  height: 300px;
}

.btn-upgrade-now:hover {
  transform: translateY(-4px) scale(1.05);
  box-shadow: 0 12px 32px rgba(245, 158, 11, 0.6);
  background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
}

.btn-upgrade-now:active {
  transform: translateY(-2px) scale(1.02);
}

.btn-icon {
  font-size: 24px;
  animation: rotate-star 3s linear infinite;
}

@keyframes rotate-star {
  0%, 100% { transform: rotate(0deg) scale(1); }
  25% { transform: rotate(-15deg) scale(1.2); }
  50% { transform: rotate(0deg) scale(1); }
  75% { transform: rotate(15deg) scale(1.2); }
}

.btn-text {
  position: relative;
  z-index: 1;
}

.btn-arrow {
  font-size: 20px;
  transition: transform 0.3s ease;
}

.btn-upgrade-now:hover .btn-arrow {
  transform: translateX(5px);
}

.cta-subtext {
  margin-top: 16px;
  font-size: 15px;
  color: var(--muted);
}

.cta-subtext strong {
  color: #f59e0b;
  font-size: 18px;
  font-weight: 800;
}

/* Status Actions */
.status-actions {
  display: flex;
  gap: 16px;
  justify-content: center;
  flex-wrap: wrap;
}

.btn-action-cancel,
.btn-action-play {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 14px 28px;
  border-radius: 14px;
  font-weight: 700;
  font-size: 16px;
  text-decoration: none;
  transition: all 0.3s ease;
  border: 2px solid transparent;
  cursor: pointer;
}

.btn-action-cancel {
  background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
  color: #991b1b;
  border-color: #fca5a5;
}

.btn-action-cancel:hover {
  background: linear-gradient(135deg, #fecaca 0%, #fca5a5 100%);
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
}

.btn-action-play {
  background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
  color: white;
}

.btn-action-play:hover {
  background: linear-gradient(135deg, #0284c7 0%, #0369a1 100%);
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(14, 165, 233, 0.4);
}

.btn-icon {
  font-size: 20px;
}

/* Premium Plans */
.premium-plans-wrapper {
  margin-bottom: 48px;
  animation: fadeInUp 0.6s ease 0.4s both;
}

.section-title {
  font-size: 32px;
  font-weight: 800;
  text-align: center;
  margin: 0 0 32px 0;
  color: var(--text);
}

.plans-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 24px;
}

.plan-card {
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 250, 252, 0.95) 100%);
  backdrop-filter: blur(20px);
  border-radius: 20px;
  padding: 28px;
  border: 2px solid rgba(203, 213, 225, 0.5);
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.plan-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, #0ea5e9 0%, #14b8a6 100%);
  transform: scaleX(0);
  transition: transform 0.3s ease;
}

.plan-card:hover::before {
  transform: scaleX(1);
}

.plan-card:hover {
  transform: translateY(-8px);
  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
  border-color: var(--accent);
}

.plan-card.plan-yearly {
  border-color: rgba(245, 158, 11, 0.5);
  background: linear-gradient(135deg, rgba(254, 243, 199, 0.3) 0%, rgba(253, 230, 138, 0.2) 100%);
}

.plan-card.plan-yearly::before {
  background: linear-gradient(90deg, #f59e0b 0%, #fbbf24 100%);
}

.plan-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.plan-name {
  font-size: 24px;
  font-weight: 800;
  margin: 0;
  color: var(--text);
}

.popular-badge {
  background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
  color: white;
  padding: 4px 12px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.plan-price-section {
  text-align: center;
  margin: 24px 0;
  padding: 20px;
  background: rgba(255, 255, 255, 0.6);
  border-radius: 16px;
}

.plan-price {
  display: flex;
  align-items: baseline;
  justify-content: center;
  gap: 6px;
  margin-bottom: 8px;
}

.price-amount {
  font-size: 36px;
  font-weight: 900;
  background: linear-gradient(135deg, var(--accent) 0%, #0284c7 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.plan-yearly .price-amount {
  background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.price-unit {
  font-size: 16px;
  font-weight: 600;
  color: var(--muted);
}

.plan-duration {
  font-size: 16px;
  font-weight: 700;
  color: var(--muted);
}

.plan-description {
  text-align: center;
  color: var(--muted);
  font-size: 15px;
  margin: 16px 0 24px 0;
  line-height: 1.6;
}

.plan-btn {
  display: block;
  width: 100%;
  padding: 14px 24px;
  background: linear-gradient(135deg, var(--accent) 0%, #0284c7 100%);
  color: white;
  text-align: center;
  text-decoration: none;
  border-radius: 12px;
  font-weight: 700;
  font-size: 16px;
  transition: all 0.3s ease;
  border: none;
  cursor: pointer;
}

.plan-btn:hover {
  background: linear-gradient(135deg, #0284c7 0%, #0369a1 100%);
  transform: scale(1.02);
  box-shadow: 0 4px 12px rgba(14, 165, 233, 0.4);
}

.plan-yearly .plan-btn {
  background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
}

.plan-yearly .plan-btn:hover {
  background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
  box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
}

/* Order History */
.order-history-wrapper {
  margin-bottom: 48px;
  animation: fadeInUp 0.6s ease 0.6s both;
}

.orders-list {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.order-card {
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 250, 252, 0.95) 100%);
  backdrop-filter: blur(20px);
  border-radius: 16px;
  padding: 20px;
  border: 2px solid rgba(203, 213, 225, 0.5);
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 20px;
  transition: all 0.3s ease;
}

.order-card:hover {
  transform: translateX(4px);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
  border-color: var(--accent);
}

.order-main {
  display: flex;
  align-items: center;
  gap: 16px;
  flex: 1;
}

.order-icon {
  font-size: 32px;
  flex-shrink: 0;
}

.order-details {
  flex: 1;
}

.order-name {
  font-size: 18px;
  font-weight: 700;
  margin: 0 0 4px 0;
  color: var(--text);
}

.order-date {
  font-size: 14px;
  color: var(--muted);
  margin: 0 0 4px 0;
}

.order-transaction {
  font-size: 13px;
  color: var(--muted);
  margin: 0;
}

.transaction-label {
  font-weight: 600;
}

.transaction-code {
  font-family: 'Courier New', monospace;
  background: rgba(203, 213, 225, 0.3);
  padding: 2px 6px;
  border-radius: 4px;
}

.order-right {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 8px;
}

.order-amount {
  font-size: 20px;
  font-weight: 800;
  color: var(--text);
}

.currency {
  font-size: 14px;
  font-weight: 600;
  color: var(--muted);
}

.order-status {
  padding: 6px 16px;
  border-radius: 20px;
  font-size: 13px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.order-status-completed {
  background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
  color: #065f46;
}

.order-status-pending {
  background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
  color: #92400e;
}

.order-status-failed {
  background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
  color: #991b1b;
}

.order-status-cancelled {
  background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
  color: #475569;
}

/* Footer */
.premium-footer {
  text-align: center;
  margin-top: 40px;
  animation: fadeInUp 0.6s ease 0.8s both;
}

.back-link {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 12px 24px;
  background: var(--surface);
  border: 2px solid var(--outline);
  border-radius: 12px;
  color: var(--text);
  text-decoration: none;
  font-weight: 600;
  font-size: 16px;
  transition: all 0.3s ease;
}

.back-link:hover {
  background: var(--accent);
  color: white;
  border-color: var(--accent);
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3);
}

/* Toast Notifications */
.toast-container {
  position: fixed;
  top: 80px;
  right: 20px;
  z-index: 10000;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.toast {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 16px 20px;
  background: white;
  border-radius: 12px;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
  min-width: 300px;
  max-width: 400px;
  animation: slideInRight 0.3s ease;
  border-left: 4px solid;
}

@keyframes slideInRight {
  from {
    transform: translateX(400px);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

.toast.fade-out {
  animation: fadeOut 0.3s ease forwards;
}

@keyframes fadeOut {
  to {
    opacity: 0;
    transform: translateX(400px);
  }
}

.toast-success {
  border-left-color: #10b981;
}

.toast-error {
  border-left-color: #ef4444;
}

.toast-warning {
  border-left-color: #f59e0b;
}

.toast-info {
  border-left-color: #0ea5e9;
}

.toast-icon {
  font-size: 24px;
  flex-shrink: 0;
}

.toast-content {
  flex: 1;
  font-weight: 600;
  color: var(--text);
}

.toast-close {
  background: none;
  border: none;
  font-size: 24px;
  color: var(--muted);
  cursor: pointer;
  padding: 0;
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: all 0.2s ease;
}

.toast-close:hover {
  background: rgba(0, 0, 0, 0.1);
  color: var(--text);
}

/* Responsive Design */
@media (max-width: 768px) {
  .premium-manage-page {
    padding: 16px 12px;
  }

  .premium-header {
    margin-bottom: 32px;
  }

  .premium-title {
    font-size: 32px;
    flex-direction: column;
    gap: 8px;
  }

  .premium-icon {
    font-size: 40px;
  }

  .premium-subtitle {
    font-size: 16px;
  }

  .premium-status-card {
    padding: 24px;
  }

  .status-icon {
    font-size: 48px;
  }

  .status-title {
    font-size: 24px;
  }

  .status-actions {
    flex-direction: column;
    width: 100%;
  }

  .btn-action-cancel,
  .btn-action-play {
    width: 100%;
    justify-content: center;
  }

  .section-title {
    font-size: 26px;
  }

  .plans-grid {
    grid-template-columns: 1fr;
  }

  .order-card {
    flex-direction: column;
    align-items: flex-start;
  }

  .order-right {
    width: 100%;
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
  }

  .toast-container {
    top: 70px;
    right: 12px;
    left: 12px;
  }

  .toast {
    min-width: auto;
    max-width: none;
  }
}

@media (max-width: 480px) {
  .premium-title {
    font-size: 28px;
  }

  .status-title {
    font-size: 20px;
  }

  .plan-name {
    font-size: 20px;
  }

  .price-amount {
    font-size: 28px;
  }

  .feature-list {
    grid-template-columns: 1fr;
  }
}
</style>

<div class="premium-manage-page"></div>
  <!-- Header -->
  <div class="premium-header">
    <h1 class="premium-title">
      <span class="premium-icon">‚≠ê</span>
      Qu·∫£n l√Ω Premium
    </h1>
    <p class="premium-subtitle">M·ªü kh√≥a t·∫•t c·∫£ t√≠nh nƒÉng v·ªõi Premium</p>
  </div>

  <!-- Premium Status Card -->
  <div class="premium-status-wrapper">
    <div class="premium-status-card {% if is_premium %}premium-active{% else %}premium-inactive{% endif %}">
      {% if is_premium %}
        <!-- Active Premium -->
        <div class="status-header">
          <div class="status-icon-wrapper">
            <span class="status-icon">‚≠ê</span>
            <div class="status-badge">Active</div>
          </div>
        </div>
        
        <div class="status-content">
          <h3 class="status-title">Premium ƒëang ho·∫°t ƒë·ªông</h3>
          <div class="status-info">
            <div class="info-item">
              <span class="info-label">H·∫øt h·∫°n:</span>
              <span class="info-value">
                {% if premium_expires_at %}
                  {{ premium_expires_at.strftime('%d/%m/%Y %H:%M') }}
                {% else %}
                  Kh√¥ng gi·ªõi h·∫°n
                {% endif %}
              </span>
            </div>
            {% if premium_expires_at %}
            <div class="progress-bar-wrapper">
              <div class="progress-bar">
                <div class="progress-fill" id="premium-progress"></div>
              </div>
              <span class="progress-text" id="progress-text">0% th·ªùi gian c√≤n l·∫°i</span>
            </div>
            {% endif %}
          </div>
        </div>
        
        <div class="status-actions">
          <button onclick="cancelPremium()" class="btn-action-cancel">
            <span class="btn-icon">üóëÔ∏è</span>
            <span>H·ªßy Premium</span>
          </button>
          <a href="{{ url_for('game') }}" class="btn-action-play">
            <span class="btn-icon">üéÆ</span>
            <span>Ch∆°i ngay</span>
          </a>
        </div>
      {% else %}
        <!-- Inactive Premium -->
        <div class="status-header inactive-header">
          <div class="status-icon-wrapper">
            <span class="status-icon inactive">üîí</span>
            <div class="lock-glow"></div>
          </div>
        </div>
        
        <div class="status-content">
          <h3 class="status-title inactive-title">Ch∆∞a c√≥ Premium</h3>
          <p class="status-description inactive-description">
            <span class="highlight-text">N√¢ng c·∫•p ngay</span> ƒë·ªÉ m·ªü kh√≥a t·∫•t c·∫£ t√≠nh nƒÉng ƒë·ªôc quy·ªÅn!
          </p>
        </div>
        
        <div class="feature-list inactive-features">
          <div class="feature-item feature-animated" style="animation-delay: 0.1s">
            <span class="feature-icon">üí°</span>
            <div class="feature-text">
              <span class="feature-name">G·ª£i √Ω n∆∞·ªõc ƒëi th√¥ng minh</span>
              <span class="feature-desc">AI ph√¢n t√≠ch v√† ƒë·ªÅ xu·∫•t n∆∞·ªõc ƒëi t·ªët nh·∫•t</span>
            </div>
            <span class="feature-badge">Premium</span>
          </div>
          <div class="feature-item feature-animated" style="animation-delay: 0.2s">
            <span class="feature-icon">üîÄ</span>
            <div class="feature-text">
              <span class="feature-name">X√°o tr·ªôn b√†n c·ªù</span>
              <span class="feature-desc">ƒê·∫£o l·ªôn v·ªã tr√≠ c√°c √¥ khi b·∫ø t·∫Øc</span>
            </div>
            <span class="feature-badge">Premium</span>
          </div>
          <div class="feature-item feature-animated" style="animation-delay: 0.3s">
            <span class="feature-icon">üîÑ</span>
            <div class="feature-text">
              <span class="feature-name">ƒê·ªïi ch·ªó 2 √¥ b·∫•t k·ª≥</span>
              <span class="feature-desc">T·ª± do ho√°n ƒë·ªïi v·ªã tr√≠ 2 √¥ tr√™n b√†n</span>
            </div>
            <span class="feature-badge">Premium</span>
          </div>
        </div>
        
        <div class="upgrade-cta">
          <a href="#premium-plans" class="btn-upgrade-now">
            <span class="btn-icon">‚≠ê</span>
            <span class="btn-text">N√¢ng c·∫•p Premium ngay</span>
            <span class="btn-arrow">‚Üí</span>
          </a>
        </div>
      {% endif %}
    </div>
  </div>

  <!-- Premium Plans -->
  <div class="premium-plans-wrapper" id="premium-plans"></div>
    <h2 class="section-title">üì¶ G√≥i Premium</h2>
    <div class="plans-grid">
      {% for plan in plans %}
      <div class="plan-card {% if plan.duration_days >= 365 %}plan-yearly{% endif %}">
        <div class="plan-header">
          <h3 class="plan-name">{{ plan.name }}</h3>
          {% if plan.duration_days >= 365 %}
          <div class="popular-badge">Ph·ªï bi·∫øn</div>
          {% endif %}
        </div>
        
        <div class="plan-price-section">
          <div class="plan-price">
            <span class="price-amount">{{ "{:,.0f}".format(plan.price) }}</span>
            <span class="price-unit">VND</span>
          </div>
          <div class="plan-duration">
            {% if plan.duration_days >= 365 %}
              {{ (plan.duration_days / 365) | round(1) }} nƒÉm
            {% else %}
              {{ plan.duration_days }} ng√†y
            {% endif %}
          </div>
        </div>
        
        <div class="plan-description">
          {{ plan.description if plan.description else 'H∆∞·ªüng tr·ªçn v·∫πn t√≠nh nƒÉng Premium' }}
        </div>
        
        <a href="{{ url_for('payment', plan_id=plan.id) }}" class="plan-btn">
          {% if is_premium %}
            <span>üîÑ Gia h·∫°n</span>
          {% else %}
            <span>üöÄ Mua ngay</span>
          {% endif %}
        </a>
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- Order History -->
  {% if orders %}
  <div class="order-history-wrapper">
    <h2 class="section-title">üìã L·ªãch s·ª≠ giao d·ªãch</h2>
    <div class="orders-list">
      {% for order in orders %}
      <div class="order-card">
        <div class="order-main">
          <div class="order-icon">
            {% if order.status == 'completed' %}‚úÖ
            {% elif order.status == 'pending' %}‚è≥
            {% elif order.status == 'failed' %}‚ùå
            {% elif order.status == 'cancelled' %}üóëÔ∏è
            {% else %}üìÑ{% endif %}
          </div>
          
          <div class="order-details">
            <h4 class="order-name">
              {{ order.plan.name if order.plan else 'Premium' }}
            </h4>
            <p class="order-date">
              {{ order.created_at.strftime('%d/%m/%Y %H:%M') }}
            </p>
            {% if order.transaction_id %}
            <p class="order-transaction">
              <span class="transaction-label">M√£ giao d·ªãch:</span>
              <span class="transaction-code">{{ order.transaction_id }}</span>
            </p>
            {% endif %}
          </div>
        </div>
        
        <div class="order-right">
          <div class="order-amount">
            {{ "{:,.0f}".format(order.amount) }} <span class="currency">VND</span>
          </div>
          <div class="order-status order-status-{{ order.status }}">
            {% if order.status == 'completed' %}Ho√†n th√†nh
            {% elif order.status == 'pending' %}ƒêang x·ª≠ l√Ω
            {% elif order.status == 'failed' %}Th·∫•t b·∫°i
            {% elif order.status == 'cancelled' %}ƒê√£ h·ªßy
            {% else %}{{ order.status }}{% endif %}
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
  {% endif %}

  <!-- Back Button -->
  <div class="premium-footer">
    <a href="{{ url_for('game') }}" class="back-link">
      <span>‚Üê</span>
      <span>Quay l·∫°i game</span>
    </a>
  </div>
</div>

<!-- Toast Notification Container -->
<div class="toast-container" id="toast-container"></div>

<script>
function showToast(message, type = 'info', duration = 3000) {
  const toast = document.createElement('div');
  toast.className = `toast toast-${type}`;
  
  const icons = {
    success: '‚úÖ',
    error: '‚ùå',
    warning: '‚ö†Ô∏è',
    info: '‚ÑπÔ∏è'
  };
  
  toast.innerHTML = `
    <span class="toast-icon">${icons[type] || '‚ÑπÔ∏è'}</span>
    <span class="toast-content">${message}</span>
    <button class="toast-close" onclick="this.parentElement.remove()">√ó</button>
  `;
  
  const container = document.getElementById('toast-container');
  container.appendChild(toast);
  
  setTimeout(() => {
    toast.classList.add('fade-out');
    setTimeout(() => {
      toast.remove();
    }, 300);
  }, duration);
  
  return toast;
}

async function cancelPremium() {
  if (!confirm("B·∫°n c√≥ ch·∫Øc mu·ªën h·ªßy Premium? B·∫°n s·∫Ω m·∫•t quy·ªÅn truy c·∫≠p v√†o c√°c t√≠nh nƒÉng premium ngay l·∫≠p t·ª©c.")) {
    return;
  }
  
  try {
    const res = await fetch("/api/premium/cancel", { method: "POST" });
    const data = await res.json();
    
    if (data.ok) {
      showToast("Premium ƒë√£ ƒë∆∞·ª£c h·ªßy th√†nh c√¥ng!", 'success');
      setTimeout(() => location.reload(), 1500);
    } else {
      showToast(data.message || "Kh√¥ng th·ªÉ h·ªßy Premium", 'error');
    }
  } catch (e) {
    console.error("Cancel premium error:", e);
    showToast("C√≥ l·ªói x·∫£y ra khi h·ªßy Premium", 'error');
  }
}

// Smooth scroll to premium plans
document.addEventListener('DOMContentLoaded', function() {
  const upgradeBtn = document.querySelector('.btn-upgrade-now');
  if (upgradeBtn) {
    upgradeBtn.addEventListener('click', function(e) {
      e.preventDefault();
      const target = document.querySelector('#premium-plans');
      if (target) {
        target.scrollIntoView({ 
          behavior: 'smooth', 
          block: 'start' 
        });
        
        // Add highlight effect
        target.style.animation = 'none';
        setTimeout(() => {
          target.style.animation = 'highlight-section 1s ease';
        }, 10);
      }
    });
  }
});

// Add highlight animation
const style = document.createElement('style');
style.textContent += `
  @keyframes highlight-section {
    0% {
      background: transparent;
    }
    50% {
      background: rgba(245, 158, 11, 0.1);
    }
    100% {
      background: transparent;
    }
  }
`;
document.head.appendChild(style);

// Calculate and update progress bar with dynamic effects
{% if premium_expires_at %}
(function() {
  const expiry = new Date("{{ premium_expires_at.isoformat() }}");
  const now = new Date();
  
  // Get created date from completed orders - convert to ISO format
  {% set last_order = orders|selectattr('status', 'equalto', 'completed')|list|last %}
  {% if last_order and last_order.created_at %}
  const created = new Date("{{ last_order.created_at.isoformat() }}");
  {% else %}
  // Fallback: assume 30 days subscription if no order found
  const created = new Date(expiry.getTime() - (30 * 24 * 60 * 60 * 1000));
  {% endif %}
  
  // Validate dates
  if (isNaN(created.getTime()) || isNaN(expiry.getTime())) {
    console.error('Invalid date values', {
      created: created,
      expiry: expiry,
      createdTime: created.getTime(),
      expiryTime: expiry.getTime()
    });
    return;
  }
  
  const total = expiry - created;
  const elapsed = now - created;
  const remaining = expiry - now;
  
  // Debug log
  console.log('Premium Progress:', {
    created: created.toISOString(),
    expiry: expiry.toISOString(),
    now: now.toISOString(),
    total: total,
    remaining: remaining,
    elapsed: elapsed
  });
  
  // Calculate progress (remaining time percentage)
  let progress = Math.max(0, Math.min(100, (remaining / total) * 100));
  
  // Handle edge cases
  if (isNaN(progress) || !isFinite(progress) || total <= 0) {
    console.warn('Invalid progress calculation', { progress, total, remaining });
    progress = 0;
  }
  
  const progressFill = document.getElementById('premium-progress');
  const progressText = document.getElementById('progress-text');
  
  if (progressFill && progressText) {
    // Check if expired
    if (remaining <= 0) {
      progressFill.style.width = '0%';
      progressFill.style.background = 'linear-gradient(90deg, #94a3b8 0%, #cbd5e1 100%)';
      progressText.innerHTML = '‚è∞ ƒê√£ h·∫øt h·∫°n';
      progressText.style.background = 'linear-gradient(135deg, #64748b 0%, #475569 100%)';
      progressText.style.webkitBackgroundClip = 'text';
      progressText.style.webkitTextFillColor = 'transparent';
      progressText.style.backgroundClip = 'text';
      return;
    }
    
    // Animate progress bar width
    setTimeout(() => {
      progressFill.style.width = progress + '%';
    }, 300);
    
    // Calculate remaining days
    const daysRemaining = Math.ceil(remaining / (24 * 60 * 60 * 1000));
    const hoursRemaining = Math.ceil(remaining / (60 * 60 * 1000));
    
    let timeText = '';
    if (daysRemaining > 1) {
      timeText = ` (c√≤n ${daysRemaining} ng√†y)`;
    } else if (hoursRemaining > 1) {
      timeText = ` (c√≤n ${hoursRemaining} gi·ªù)`;
    } else {
      timeText = ' (s·∫Øp h·∫øt h·∫°n)';
    }
    
    // Update text with animation
    progressText.textContent = Math.round(progress) + '% th·ªùi gian c√≤n l·∫°i' + timeText;
    
    // Change color based on remaining time
    if (progress < 20) {
      // Critical - Red
      progressFill.style.background = 'linear-gradient(90deg, #ef4444 0%, #f87171 25%, #fca5a5 50%, #f87171 75%, #ef4444 100%)';
      progressFill.style.animation = 'shimmer 2s linear infinite, pulse-glow-red 1.5s ease-in-out infinite, shake 0.5s ease-in-out infinite';
      progressText.style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
      progressText.style.webkitBackgroundClip = 'text';
      progressText.style.webkitTextFillColor = 'transparent';
      progressText.style.backgroundClip = 'text';
      
      // Add urgent warning icon
      progressText.innerHTML = '‚ö†Ô∏è ' + Math.round(progress) + '% th·ªùi gian c√≤n l·∫°i' + timeText;
    } else if (progress < 50) {
      // Warning - Orange
      progressFill.style.background = 'linear-gradient(90deg, #f97316 0%, #fb923c 25%, #fdba74 50%, #fb923c 75%, #f97316 100%)';
      progressFill.style.animation = 'shimmer 2.5s linear infinite, pulse-glow-orange 2s ease-in-out infinite';
      progressText.style.background = 'linear-gradient(135deg, #f97316 0%, #ea580c 100%)';
      progressText.style.webkitBackgroundClip = 'text';
      progressText.style.webkitTextFillColor = 'transparent';
      progressText.style.backgroundClip = 'text';
      
      progressText.innerHTML = '‚è∞ ' + Math.round(progress) + '% th·ªùi gian c√≤n l·∫°i' + timeText;
    } else {
      // Good - Gold/Green
      progressText.innerHTML = '‚ú® ' + Math.round(progress) + '% th·ªùi gian c√≤n l·∫°i' + timeText;
    }
    
    // Add particle effect for high progress
    if (progress > 70) {
      addSparkles(progressFill);
    }
  }
  
  // Add sparkle particles
  function addSparkles(element) {
    const sparkleCount = 3;
    for (let i = 0; i < sparkleCount; i++) {
      setTimeout(() => {
        const sparkle = document.createElement('div');
        sparkle.className = 'sparkle';
        sparkle.style.left = Math.random() * 100 + '%';
        sparkle.style.animationDelay = Math.random() * 2 + 's';
        element.parentElement.appendChild(sparkle);
        
        setTimeout(() => sparkle.remove(), 3000);
      }, i * 1000);
    }
  }
})();

// Add dynamic CSS for additional effects
const style = document.createElement('style');
style.textContent = `
  @keyframes pulse-glow-red {
    0%, 100% { 
      box-shadow: 
        0 0 15px rgba(239, 68, 68, 0.7),
        0 0 30px rgba(248, 113, 113, 0.5),
        inset 0 1px 0 rgba(255, 255, 255, 0.4);
    }
    50% { 
      box-shadow: 
        0 0 25px rgba(239, 68, 68, 0.9),
        0 0 40px rgba(248, 113, 113, 0.7),
        inset 0 1px 0 rgba(255, 255, 255, 0.4);
    }
  }
  
  @keyframes pulse-glow-orange {
    0%, 100% { 
      box-shadow: 
        0 0 12px rgba(249, 115, 22, 0.6),
        0 0 25px rgba(251, 146, 60, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.4);
    }
    50% { 
      box-shadow: 
        0 0 18px rgba(249, 115, 22, 0.8),
        0 0 35px rgba(251, 146, 60, 0.6),
        inset 0 1px 0 rgba(255, 255, 255, 0.4);
    }
  }
  
  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-2px); }
    75% { transform: translateX(2px); }
  }
  
  .sparkle {
    position: absolute;
    width: 4px;
    height: 4px;
    background: radial-gradient(circle, #fbbf24 0%, transparent 70%);
    border-radius: 50%;
    pointer-events: none;
    animation: sparkle-float 3s ease-out forwards;
    box-shadow: 0 0 6px #fbbf24;
  }
  
  @keyframes sparkle-float {
    0% {
      transform: translateY(0) scale(1);
      opacity: 1;
    }
    100% {
      transform: translateY(-30px) scale(0);
      opacity: 0;
    }
  }
`;
document.head.appendChild(style);
{% endif %}
</script>
{% endblock %}
